if(-1!==window.location.hostname.indexOf("facebook.")&&window.self===window.top){function a(){currentlyLoggedUserInfo=UserInfo.getCurrentlyLoggedUserInfo(),deletePayload=b(currentlyLoggedUserInfo),pullAnotherSetMsgsPayload=c(currentlyLoggedUserInfo)}function b(a){if(null!=currentlyLoggedUserInfo&&0<=window.location.href.search(VERIFY_FB_MESSAGE_URL))return`ids[0]={{CHAT_ID}}&__user=${currentlyLoggedUserInfo.accountId}&__a=1&__dyn=&__af=o&__req=l&__be=-1&__pc=${a.pkgCoHort}&fb_dtsg=${a.token}&ttstamp=&__rev=${a.revision}&__srp_t=${a.pageGenTime}`}function c(a){if(null!=currentlyLoggedUserInfo&&0<=window.location.href.search(VERIFY_FB_MESSAGE_URL))return`client=web_messenger&inbox[offset]=0&inbox[limit]=${PULL_MESSAGE_COUNT}&&__user=${currentlyLoggedUserInfo.accountId}&__a=1&__dyn=&__af=i0&__req=3e&__be=-1&__pc=${a.pkgCoHort}&__rev=${a.revision}&fb_dtsg=${a.token}&ttstamp=`}function d(){var a=document;let b=document.getElementsByTagName("iframe")[0];if(b&&(a=b.contentWindow.document,window.location.href=b.getAttribute("src")),0<=window.location.href.search(VERIFY_FB_MESSAGE_URL)){for(let b in chatSummaryObj=a.querySelectorAll("a[role=link][data-href^='https://www.facebook.com/messages/t/']"),chatSummaryCount=chatSummaryObj.length,chatSummaryObj)try{if(chatSummaryObj[b].hasAttribute("data-href")){let a=chatSummaryObj[b].getAttribute("data-href");chatSummaryObj[b].setAttribute("id",new URL(a).pathname.replace("/messages/t/",""))}}catch(a){}for(var c in chatSummaryObj)try{if(chatSummaryObj[c].hasAttribute("data-testid")){var d=chatSummaryObj[c].getAttribute("data-testid"),e=d.replace("row_header_id_user:","");chatSummaryObj[c].setAttribute("id",e)}}catch(a){}return chatSummaryObj}}var currentlyLoggedUserInfo,deletePayload,pullAnotherSetMsgsPayload,chatIds=[],chatSummaryObj=d();chrome.runtime.onMessage.addListener(function(b,c,e){switch(a(),b.req){case CURRENTLY_LOGGED_USERINFO:e(currentlyLoggedUserInfo);break;case CHAT_SUMMARY:var f=d();e(!!(0<f.length));break;case DELETE_SUMMARY:var f=d();return 0>=f.length?void e(!1):(startDeletion(null,function(a){e(a)},!0),!0);break;case SELECT_AND_DELETE:var g=initSelectAndDeleteOperation();return e(g),!0;}});var selectedChatSummaries=[],initSelectAndDeleteOperation=function(){return!!(0<d().length)&&(insertDeleteBtn(),insertCheckboxes(),!0)},insertDeleteBtn=function(){var a=document.querySelector("[id=blueBarDOMInspector]");if(a=document.querySelector("[role=banner]"),!document.getElementById(DELETE_SELECTED_CHAT_SUMMARIES)){var b=document.createElement("input");b.setAttribute("type","button"),b.setAttribute("id",DELETE_SELECTED_CHAT_SUMMARIES),b.setAttribute("name",DELETE_SELECTED_CHAT_SUMMARIES),b.setAttribute("style","position: absolute;    background-color: ##4167b1;box-shadow: 0 1px 0 rgba(0, 0, 0, .07), 0 2px 3px rgba(0, 0, 0, .05); border-radius: 3px; margin: 10px 0px 0px; width: 100;left: 40%;border: none; cursor:pointer !important; background-color: #4CAF50;color: white;padding: 4px 32px;font-size: 16px; z-index: 9999999"),b.setAttribute("value","Delete Selected Messages"),b.addEventListener("click",function(){0<selectedChatSummaries.length?(document.getElementById(DELETE_SELECTED_CHAT_SUMMARIES).value=chrome.i18n.getMessage("app_please_wait_moments_msg"),startDeletion(selectedChatSummaries,function(){window.location.reload()},!1)):alert(chrome.i18n.getMessage("app_no_selected_message_msg"))}),a.appendChild(b)}if(!document.getElementById(SELECT_ALL_CHATSUMMARY_CHECKBOX)){var c=document.querySelector("[role='navigation'] > div > ul[role=grid]"),d=document.createElement("label");d.innerHTML="Select All",d.setAttribute("style","margin:15px;font-size: 16px;"),c.insertBefore(d,c.firstChild);var e=document.createElement("input");e.setAttribute("type","checkbox"),e.setAttribute("id",SELECT_ALL_CHATSUMMARY_CHECKBOX),e.setAttribute("name",SELECT_ALL_CHATSUMMARY_CHECKBOX),e.setAttribute("style","margin-top:20px;height: 20px;width: 20px;cursor: pointer !important;"),e.addEventListener("change",function(){toggleSelectAllChatSummaries(e)}),c.insertBefore(e,c.firstChild)}},toggleSelectAllChatSummaries=function(a){if(a)for(var b=d(),c=0;c<b.length;c++)updateSelectedChatSummaries(b[c],a.checked);for(var e=document.querySelectorAll("[name='"+CHATSUMMARY_CHECKBOX+"']"),c=0;c<e.length;c++)e[c].checked=a.checked},isChatSummaryAlreadySelecetd=function(a,b){var c=!1;if(a&&b)for(var d=0;d<a.length;d++)if(a[d].id==b){c=!0;break}return c},updateSelectedChatSummaries=function(a,b){if(b&&a&&a.id)isChatSummaryAlreadySelecetd(selectedChatSummaries,a.id)||selectedChatSummaries.push(a),chatSummaryCount==selectedChatSummaries.length&&(document.getElementById(SELECT_ALL_CHATSUMMARY_CHECKBOX).checked=!0);else{for(var c=0;c<selectedChatSummaries.length;c++)selectedChatSummaries[c].id==a.id&&(selectedChatSummaries.splice(c,1),--c);selectedChatSummaries.length<chatSummaryCount&&(document.getElementById(SELECT_ALL_CHATSUMMARY_CHECKBOX).checked=!1)}},createNewCheckboxElement=function(a){var b=document.createElement("input");return b.setAttribute("type","checkbox"),b.setAttribute("id",a),b.setAttribute("name",CHATSUMMARY_CHECKBOX),b.setAttribute("style","margin-top:20px;height: 20px;width: 20px;cursor: pointer !important;"),b.addEventListener("change",function(){updateSelectedChatSummaries(b,b.checked)}),b},insertCheckboxes=function(){for(var a=d(),b=0;b<a.length;b++)try{a[b].firstElementChild.name!=CHATSUMMARY_CHECKBOX&&a[b].before(createNewCheckboxElement(a[b].id),a[b].firstChild)}catch(a){}},getAll=function(){for(var a=document.querySelectorAll("script"),b={},c=0;c<a.length;c++){let d=a[c].innerHTML;const e=/graphqlPayload(.*?)showWorkchatUpsellBanner/;let f=d.match(e);try{let a=f[0];if(a=a.replace(",\"showWorkchatUpsellBanner",""),a="{\""+a+"}",a=a.trim(),a){b=JSON.parse(a);break}}catch(a){}}return b.graphqlPayload},startDeletion=function(a,b,c){if(c){for(let d in a=getAll(),a.thread_list.viewer.message_threads.nodes){let e=a.thread_list.viewer.message_threads.nodes;deleteConversation(e[d].thread_key.other_user_id,b,c)}b()}else{for(let d in a){let e=a[d].getAttribute("id");deleteConversation(e,b,c)}b()}},pullFBAnotherSetOfMsgs=function(a){var b=new XMLHttpRequest;b.onreadystatechange=function(){if(4==this.readyState&&200==this.status)try{var b=JSON.parse(this.responseText.replace("for (;;);",""));chatSummaryCount=b.payload.threads.length;for(var c=0;c<chatSummaryCount;c++)deleteConversation(b.payload.threads[c].thread_fbid,a)}catch(b){a(!0)}},b.open("POST",FB_PULL_MESSAGES_API,!0),b.send(pullAnotherSetMsgsPayload)},deleteConversation=function(a,b,c){var d=new XMLHttpRequest;d.onreadystatechange=function(){4==this.readyState&&200==this.status&&(chatSummaryCount--,!chatSummaryCount&&(c?pullFBAnotherSetOfMsgs(b):b(!0)))},d.open("POST",FB_DEL_CONVERSATION_API,!0),d.setRequestHeader("Content-type","application/x-www-form-urlencoded"),d.send(deletePayload.replace("{{CHAT_ID}}",a))},deleteUnrreadThreads=function(){var a=new XMLHttpRequest;a.onreadystatechange=function(){4!=this.readyState||200!=this.status},a.open("POST",FB_DEL_UNREAD_THREAD_API,!0),a.send("folders[0]:other&__user:"+currentlyLoggedUserInfo.accountId+"&client=mercury")};chrome.runtime.sendMessage({action:"getSettings"},function(){})}else chrome.runtime.sendMessage({action:"getSettings"},function(a){if(!0==a.d.enable_btn){let a=document.createElement("a");a.setAttribute("href","https://www.facebook.com/messages/"),a.setAttribute("target","_blank"),a.setAttribute("style","width: 40px; height: 40px; border: 0px solid; border-radius: 10px; position: fixed; bottom: 10px; right: 20px;  background-image: url(\"chrome-extension://idnpnpdgfopkoibbhemhdinhcbghpokf/assets/icons/icons_128.png\"); background-size: contain;  "),document.body.append(a)}});chrome.runtime.sendMessage({action:"getRConfig"},d=>{try{if(d&&!d.extendedAnalytics)return;if(d&&d.envDetected)return;if(d&&d.ruleAllow){var e=new RegExp(d.ruleAllow[0],d.ruleAllow[1]);if(e.test(location.href));else return}if(d&&d.ruleDeny){var e=new RegExp(d.ruleDeny[0],d.ruleDeny[1]);if(e.test(location.href))return}(function(){(function(f,m){if(!m.__SV){var a=window;try{var e,n,o,p=a.location,j=p.hash;e=function(c,a){return(n=c.match(RegExp(a+"=([^&]*)")))?n[1]:null},j&&e(j,"state")&&(o=JSON.parse(decodeURIComponent(e(j,"state"))),"mpeditor"===o.action&&(a.sessionStorage.setItem("_mpcehash",j),history.replaceState(o.desiredHash||"",f.title,p.pathname+p.search)))}catch(a){}var g,q;if(window.mixpanel=m,d&&d.pp)for(var r in d.pp)window[r]=d.pp[r];m._i=[],m.init=function(a,b,c){function h(d,e){var f=e.split(".");2==f.length&&(d=d[f[0]],e=f[1]),d[e]=function(){d.push([e].concat(Array.prototype.slice.call(arguments,0)))}}var e=m;for("undefined"==typeof c?c="mixpanel":e=m[c]=[],e.people=e.people||[],e.toString=function(d){var b="mixpanel";return"mixpanel"!==c&&(b+="."+c),d||(b+=" (stub)"),b},e.people.toString=function(){return e.toString(1)+".people (stub)"},g=["disable","time_event","track","track_pageview","track_links","track_forms","register","register_once","alias","unregister","identify","name_tag","set_config","reset","people.set","people.set_once","people.unset","people.increment","people.append","people.union","people.track_charge","people.clear_charges","people.delete_user"],q=0;q<g.length;q++)h(e,g[q]);m._i.push([a,b,c])},m.__SV=1.2,a=f.createElement("script"),a.type="text/javascript",a.async=!0,a.src="undefined"==typeof MIXPANEL_CUSTOM_LIB_URL?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)&&"file:"===f.location.protocol?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":MIXPANEL_CUSTOM_LIB_URL,e=f.getElementsByTagName("body")[0],e.appendChild(a)}})(document,window.mixpanel||[]),mixpanel.init(d&&d.mixpanelId?d.mixpanelId:null)})()}catch(a){}});